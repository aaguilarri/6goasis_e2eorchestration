apiVersion: v1
kind: Pod
metadata:
  name: 6g-monitoring-consumer
  namespace: monitoring
  labels:
    app: 6g-monitoring
    component: consumer
spec:
  nodeSelector:
    node: monitoring
  hostAliases:
  - ip: "10.22.22.7"
    hostnames:
    - "kafka"
  containers:
  - name: 6g-consumer
    image: localhost:32000/6g-monitoring:registry
    imagePullPolicy: Always  # Use locally built image
    ports:
    - containerPort: 8000
      name: metrics
      protocol: TCP
    env:
    - name: PYTHONUNBUFFERED
      value: "1"
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"
    livenessProbe:
      httpGet:
        path: /metrics
        port: 8000
      initialDelaySeconds: 30
      periodSeconds: 10
    readinessProbe:
      httpGet:
        path: /metrics
        port: 8000
      initialDelaySeconds: 5
      periodSeconds: 5
  restartPolicy: Always

---
# Service to expose the metrics endpoint
apiVersion: v1
kind: Service
metadata:
  name: monitoring-6g-service
  namespace: monitoring
  labels:
    app: 6g-monitoring
spec:
  selector:
    app: 6g-monitoring
  ports:
  - port: 8000
    targetPort: 8000
    name: metrics
  type: ClusterIP
